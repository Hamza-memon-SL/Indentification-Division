IDENTIFICATION DIVISION.
PROGRAM-ID. INTEREST-CALCULATION.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT FILE1 ASSIGN TO "INCUSTFL"
        ORGANIZATION IS SEQUENTIAL.
    SELECT FILE2 ASSIGN TO "INDAILBA"
        ORGANIZATION IS SEQUENTIAL.
    SELECT FILE3 ASSIGN TO "INPASTDU"
        ORGANIZATION IS SEQUENTIAL.
    SELECT OUT-FILE ASSIGN TO "OUTINTFL"
        ORGANIZATION IS SEQUENTIAL.

DATA DIVISION.
FILE SECTION.

FD  FILE1.
01  FILE1-RECORD.
    05  FILE1-ACCOUNT-NO      PIC 9(16) COMP-3.
    05  FILE1-BILLING-CYCLE   PIC 9.
    05  FILE1-CUST-NAME       PIC X(30).
    05  FILE1-ADDRESS         PIC X(50).
    05  FILE1-SSN             PIC 9(9).

FD  FILE2.
01  FILE2-RECORD.
    05  FILE2-ACCOUNT-NO      PIC 9(16) COMP-3.
    05  FILE2-DAILY-BALANCE   PIC 9(7)V99.

FD  FILE3.
01  FILE3-RECORD.
    05  FILE3-ACCOUNT-NO      PIC 9(16) COMP-3.
    05  FILE3-DAYS-PAST-DUE   PIC 9(3).
    05  FILE3-PAST-DUE-AMOUNT PIC 9(7)V99.

FD  OUT-FILE.
01  OUT-FILE-RECORD.
    05  OUT-ACCOUNT-NO        PIC 9(16) COMP-3.
    05  OUT-BILLING-CYCLE     PIC 9.
    05  OUT-CUST-NAME         PIC X(30).
    05  OUT-ADDRESS           PIC X(50).
    05  OUT-SSN               PIC 9(9).
    05  OUT-PAST-DUE-AMOUNT   PIC 9(7)V99.
    05  OUT-INTEREST          PIC 9(7)V99.

WORKING-STORAGE SECTION.
01  WS-END-OF-FILE       PIC X VALUE 'N'.
01  WS-INTEREST-RATE      PIC 9V99 VALUE 0.02.   *> Example 2% interest rate

PROCEDURE DIVISION.
MAIN-PROCESS.
    OPEN INPUT FILE1 FILE2 FILE3
        OUTPUT OUT-FILE.

    PERFORM PROCESS-FILE UNTIL WS-END-OF-FILE = 'Y'.

    CLOSE FILE1 FILE2 FILE3 OUT-FILE.
    STOP RUN.

PROCESS-FILE.
    MOVE 'N' TO WS-END-OF-FILE.

    PERFORM READ-AND-PROCESS-FILE1
    PERFORM READ-AND-PROCESS-FILE2
    PERFORM READ-AND-PROCESS-FILE3.

READ-AND-PROCESS-FILE1.
    READ FILE1 INTO FILE1-RECORD
        AT END MOVE 'Y' TO WS-END-OF-FILE
        NOT AT END
            IF FILE1-BILLING-CYCLE = 1
                PERFORM PROCESS-INTEREST-CALCULATION
            END-IF
    END-READ.

PROCESS-INTEREST-CALCULATION.
    MOVE FILE1-ACCOUNT-NO TO OUT-ACCOUNT-NO
    MOVE FILE1-BILLING-CYCLE TO OUT-BILLING-CYCLE
    MOVE FILE1-CUST-NAME TO OUT-CUST-NAME
    MOVE FILE1-ADDRESS TO OUT-ADDRESS
    MOVE FILE1-SSN TO OUT-SSN.

    PERFORM FIND-DAILY-BALANCE
    PERFORM FIND-PAST-DUE-AMOUNT.

    IF OUT-PAST-DUE-AMOUNT > 0
        COMPUTE OUT-INTEREST = OUT-PAST-DUE-AMOUNT * WS-INTEREST-RATE
        WRITE OUT-FILE-RECORD
    END-IF.

FIND-DAILY-BALANCE.
    READ FILE2 INTO FILE2-RECORD
        AT END MOVE 'Y' TO WS-END-OF-FILE
        NOT AT END
            IF FILE2-ACCOUNT-NO = FILE1-ACCOUNT-NO
                MOVE FILE2-DAILY-BALANCE TO OUT-BALANCE
            END-IF
    END-READ.

FIND-PAST-DUE-AMOUNT.
    READ FILE3 INTO FILE3-RECORD
        AT END MOVE 'Y' TO WS-END-OF-FILE
        NOT AT END
            IF FILE3-ACCOUNT-NO = FILE1-ACCOUNT-NO
                MOVE FILE3-PAST-DUE-AMOUNT TO OUT-PAST-DUE-AMOUNT
            END-IF
    END-READ.
